"use strict";var l=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var j=(e,r)=>{for(var o in r)l(e,o,{get:r[o],enumerable:!0})},R=(e,r,o,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of T(r))!C.call(e,a)&&a!==o&&l(e,a,{get:()=>r[a],enumerable:!(s=b(r,a))||s.enumerable});return e};var g=e=>R(l({},"__esModule",{value:!0}),e);var I={};j(I,{graphql:()=>P});module.exports=g(I);function f(e){return typeof e!="object"||!e?!1:"headers"in e&&"ok"in e&&"json"in e&&typeof e.json=="function"&&"text"in e&&typeof e.json=="function"}async function x(e){if(!(typeof e!="object"||!e)){if(f(e)){let r=e.headers.get("Content-Type")?.toLowerCase();if(r?.startsWith("application/json")||r?.startsWith("application/health+json")){let o=await e.json();if(!e.ok)throw o;return"data"in o?o.data:o}if(r?.startsWith("text/html")||r?.startsWith("text/plain")){let o=await e.text();if(!e.ok)throw o;return o}return e}return"data"in e?e.data:e}}var d=async(e,r,o=globalThis.fetch)=>{r.headers=typeof r.headers=="object"&&!Array.isArray(r.headers)?r.headers:{};let s=await o(e,r);return x(s).catch(a=>{throw{errors:typeof a=="object"&&"errors"in a?a.errors:a,response:s}})};var M={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL};var Q=e=>{let r={};if(Array.isArray(e.fields)&&e.fields.length>0){let o=(s,a=[])=>{if(typeof s=="object"){let c=[];for(let m in s){let n=s[m]??[];if(Array.isArray(n))for(let i of n)c.push(o(i,[...a,m]));else if(typeof n=="object")for(let i of Object.keys(n)){let S=n[i];for(let p of S)c.push(o(p,[...a,`${m}:${i}`]))}}return c.flatMap(m=>m)}return[...a,String(s)].join(".")};r.fields=e.fields.flatMap(s=>o(s)).join(",")}e.filter&&Object.keys(e.filter).length>0&&(r.filter=JSON.stringify(e.filter)),e.search&&(r.search=e.search),"sort"in e&&e.sort&&(r.sort=typeof e.sort=="string"?e.sort:e.sort.join(",")),typeof e.limit=="number"&&e.limit>=-1&&(r.limit=String(e.limit)),typeof e.offset=="number"&&e.offset>=0&&(r.offset=String(e.offset)),typeof e.page=="number"&&e.page>=1&&(r.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(r.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(r.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(r.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(r.groupBy=e.groupBy.join(","));for(let[o,s]of Object.entries(e))o in r||(typeof s=="string"||typeof s=="number"||typeof s=="boolean"?r[o]=String(s):r[o]=JSON.stringify(s));return r};var y="/",D=(e,r)=>(e.endsWith(y)&&(e=e.slice(0,-1)),r.startsWith(y)||(r=y+r),e+r),h=(e,r,o)=>{let s=e.pathname===y?r:D(e.pathname,r),a=new globalThis.URL(s,e);if(o)for(let[c,m]of Object.entries(Q(o)))if(m&&typeof m=="object"&&!Array.isArray(m))for(let[n,i]of Object.entries(m))a.searchParams.set(`${c}[${n}]`,String(i));else a.searchParams.set(c,m);return a};var O={},P=(e={})=>r=>{let o={...O,...e};return{async query(s,a,c="items"){let m={method:"POST",body:JSON.stringify({query:s,variables:a})};"credentials"in o&&(m.credentials=o.credentials);let n={};if("getToken"in this){let p=await this.getToken();p&&(n.Authorization=`Bearer ${p}`)}"Content-Type"in n||(n["Content-Type"]="application/json"),m.headers=n;let i=c==="items"?"/graphql":"/graphql/system",S=h(r.url,i);return await d(S.toString(),m,r.globals.fetch)}}};0&&(module.exports={graphql});
//# sourceMappingURL=index.cjs.map