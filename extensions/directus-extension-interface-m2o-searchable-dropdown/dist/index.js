import{ref as e,computed as l,resolveComponent as t,openBlock as a,createBlock as o,withCtx as i,createVNode as n,normalizeClass as r,createElementVNode as c,createTextVNode as d,createElementBlock as s,Fragment as u,renderList as p,toDisplayString as m}from"vue";import{useApi as f,useStores as v}from"@directus/extensions-sdk";var y={props:{disabled:{type:Boolean,default:!1},collection:{type:String,required:!0},field:{type:String,required:!0},value:{type:[String,Number],default:null},placeholder:{type:String,default:"Select an item"},template:{type:String,default:"name"},width:{type:String,required:!0},filter:{type:Object,default:null}},emits:["input"],setup(t,{emit:a}){const o=f(),{useCollectionsStore:i,useRelationsStore:n,useFieldsStore:r}=v(),c=i(),d=n(),s=r(),{relatedCollection:u}=function(){const e=l((()=>{var e;return null==(e=d.getRelationsForField(t.collection,t.field))?void 0:e[0]}));return{relatedCollection:l((()=>{var l;return(null==(l=e.value)?void 0:l.related_collection)?c.getCollection(e.value.related_collection):null}))}}(),p=t.template.replace("{{","").replace("}}",""),m=s.getPrimaryKeyFieldForCollection(u.value.collection);let y=!1;const h=e([]),b=e("");async function _(){try{const e=await o.get(`/items/${u.value.collection}`,{params:{limit:-1,filter:t.filter,search:b.value&&b.value!=t.value?b.value:""}});if(h.value=e.data.data,null!=t.value&&""==b.value){const e=await o.get(`/items/${u.value.collection}/${t.value}`);b.value=g(e.data.data)}}catch(e){console.warn(e)}}return _(),{results:h,setDropdown:function(e){null==e?(b.value=e,a("input",e)):(b.value=g(e),a("input",e[m.field]));_()},searchQuery:b,displayField:p,onInput:function(){y||setTimeout((()=>{_(),y=!1}),500);y=!0},primaryKey:m,outputFields:g};function g(e){let l=t.template,a="";return Object.keys(e).forEach((t=>{a="{{"+t+"}}",l=l.replace(a,e[t])})),l}}};const h={class:"item-text"};var b=((e,l)=>{const t=e.__vccOpts||e;for(const[e,a]of l)t[e]=a;return t})(y,[["render",function(e,l,f,v,y,b){const _=t("v-icon"),g=t("v-input"),w=t("v-list-item-content"),k=t("v-list-item-icon"),S=t("v-list-item"),C=t("v-divider"),F=t("v-list"),D=t("v-menu");return a(),o(D,{attached:"",disabled:f.disabled,"close-on-content-click":!0},{activator:i((({active:e,activate:t})=>[n(g,{modelValue:v.searchQuery,"onUpdate:modelValue":[l[1]||(l[1]=e=>v.searchQuery=e),v.onInput],disabled:f.disabled,placeholder:f.placeholder,class:r({"has-value":f.value}),nullable:!1,onFocus:t},{append:i((()=>[null!==f.value?(a(),o(_,{key:0,clickable:"",name:"close",onClick:l[0]||(l[0]=e=>v.setDropdown(null))})):(a(),o(_,{key:1,clickable:"",name:"expand_more",class:r(["open-indicator",{open:e}]),onClick:t},null,8,["class","onClick"]))])),_:2},1032,["modelValue","disabled","placeholder","class","onFocus","onUpdate:modelValue"])])),default:i((()=>[c("div",{class:r(["content",f.width])},[n(F,{class:"list"},{default:i((()=>[n(S,{disabled:null===f.value,onClick:l[2]||(l[2]=l=>e.$emit("input",null))},{default:i((()=>[n(w,null,{default:i((()=>[d("Deselect")])),_:1}),n(k,null,{default:i((()=>[n(_,{name:"close"})])),_:1})])),_:1},8,["disabled"]),n(C),(a(!0),s(u,null,p(v.results,((e,l)=>(a(),o(S,{key:e[v.primaryKey.field]+l,active:f.value===e[v.primaryKey.field],disabled:f.disabled,onClick:l=>v.setDropdown(e)},{default:i((()=>[n(w,null,{default:i((()=>[c("span",h,m(v.outputFields(e)),1)])),_:2},1024)])),_:2},1032,["active","disabled","onClick"])))),128))])),_:1})],2)])),_:1},8,["disabled"])}],["__file","interface.vue"]]),_={id:"select-dropdown-m2o-search",name:"M2O Dropdown with Search",icon:"arrow_drop_down_circle",description:"Show options from API",component:b,types:["uuid","string","text","integer","bigInteger"],localTypes:["m2o"],group:"relational",relational:!0,options:({relations:e})=>{const l=e.m2o?.related_collection;return console.log(l),[{field:"template",name:"Field to Show",meta:{interface:"system-display-template",options:{collectionName:l},width:"half"}},{field:"placeholder",type:"string",name:"Placeholder",meta:{interface:"input",width:"half",options:{placeholder:"Enter a placeholder"}}},{field:"filter",name:"$t:filter",type:"json",meta:{interface:"system-filter",options:{collectionName:l}}}]},recommendedDisplays:["related-values"]};export{_ as default};
